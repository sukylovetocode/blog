<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>❗ 开发 THREE.JS 应该注意的 | suky blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="just for fun">
    
    <link rel="preload" href="/blog/assets/css/0.styles.b6bfb1ac.css" as="style"><link rel="preload" href="/blog/assets/js/app.8a54f0e1.js" as="script"><link rel="preload" href="/blog/assets/js/2.99672014.js" as="script"><link rel="preload" href="/blog/assets/js/25.8bd8c2c3.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.30098915.js"><link rel="prefetch" href="/blog/assets/js/11.01a7bb32.js"><link rel="prefetch" href="/blog/assets/js/12.f6a23b29.js"><link rel="prefetch" href="/blog/assets/js/13.783d2ca3.js"><link rel="prefetch" href="/blog/assets/js/14.bbca777a.js"><link rel="prefetch" href="/blog/assets/js/15.7aee58fc.js"><link rel="prefetch" href="/blog/assets/js/16.bc1a9abb.js"><link rel="prefetch" href="/blog/assets/js/17.55ad85a5.js"><link rel="prefetch" href="/blog/assets/js/18.58d328b7.js"><link rel="prefetch" href="/blog/assets/js/19.f10316de.js"><link rel="prefetch" href="/blog/assets/js/20.4c11b076.js"><link rel="prefetch" href="/blog/assets/js/21.ceb3b920.js"><link rel="prefetch" href="/blog/assets/js/22.5de30657.js"><link rel="prefetch" href="/blog/assets/js/23.f0173a34.js"><link rel="prefetch" href="/blog/assets/js/24.225aca0c.js"><link rel="prefetch" href="/blog/assets/js/3.1bd67bfe.js"><link rel="prefetch" href="/blog/assets/js/4.69e95b75.js"><link rel="prefetch" href="/blog/assets/js/5.83a5511f.js"><link rel="prefetch" href="/blog/assets/js/6.3c2a093e.js"><link rel="prefetch" href="/blog/assets/js/7.38b54764.js"><link rel="prefetch" href="/blog/assets/js/8.6ee2f7a3.js"><link rel="prefetch" href="/blog/assets/js/9.c792a14a.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.b6bfb1ac.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">suky blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/modules/" class="nav-link">
  功能实现
</a></div><div class="nav-item"><a href="/blog/theory/" class="nav-link">
  理论
</a></div><div class="nav-item"><a href="/blog/visualization/" class="nav-link router-link-active">
  可视化
</a></div><div class="nav-item"><a href="/blog/engineering/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/blog/else/" class="nav-link">
  其他
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blog/modules/" class="nav-link">
  功能实现
</a></div><div class="nav-item"><a href="/blog/theory/" class="nav-link">
  理论
</a></div><div class="nav-item"><a href="/blog/visualization/" class="nav-link router-link-active">
  可视化
</a></div><div class="nav-item"><a href="/blog/engineering/" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/blog/else/" class="nav-link">
  其他
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/visualization/" aria-current="page" class="sidebar-link">/visualization/</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="❗-开发-three-js-应该注意的"><a href="#❗-开发-three-js-应该注意的" class="header-anchor">#</a> ❗ 开发 THREE.JS 应该注意的</h2> <ul><li><strong>MeshBasicMaterial</strong> 是唯一一个不需要光都能看到的材质，如果你遇到了 BUG，可以考虑将物体都使用该材质来帮助你找到问题</li> <li>你的物体真的在摄像机可视范围中嘛?设置的足够远看看我们是否能看到这个物体</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code>camera<span class="token punctuation">.</span>far <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span>
camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>尽可能不要在循环中制造物体，可以只制作一个物体然后通过移动位置来达到类似的效果</li> <li>永远用 BufferGeometry 性能更好</li> <li>为了更接近我们真实的感官颜色 我们最好对 renderer 处理</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code>renderer<span class="token punctuation">.</span>gammaFactor <span class="token operator">=</span> <span class="token number">2.2</span><span class="token punctuation">;</span>
renderer<span class="token punctuation">.</span>outputEncoding <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>sRGBEncoding<span class="token punctuation">;</span>
</code></pre></div><p>对物体的颜色</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Color</span><span class="token punctuation">(</span><span class="token number">0x800080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
color<span class="token punctuation">.</span><span class="token function">convertSRGBToLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//OR</span>

<span class="token keyword">const</span> material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token number">0x800080</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
material<span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">convertSRGBToLinear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>对材质</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> sRGBEncoding <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./vendor/three/build/three.module.js&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> colorMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">&quot;colorMap.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
colorMap<span class="token punctuation">.</span>encoding <span class="token operator">=</span> sRGBEncoding<span class="token punctuation">;</span>
</code></pre></div><ul><li>Draco 在 GLTF 格式文件中是最为节省性能的，模型尽可能使用 GLTF</li> <li>如果你有一堆物体需要设置是否可见，可以考虑使用分层 ，这样会使我们的性能更好</li></ul> <p><a href="https://threejs.org/docs/#api/en/core/Layers" target="_blank" rel="noopener noreferrer">three.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>不能把物体设置在同一个位置，这样会导致穿模（z-fighting）最起码要设置 0.0001 的距离避免</li> <li>永远不要移动你的场景 Scene</li> <li>不要使用 <code>preserveDrawingBuffer</code> <code>alpha buffer</code> <code>stencil buffer</code> <code>depth buffer</code> 除非你真的需要</li> <li>如果你使用了 <code>OrbitControls</code> 我们可以通过设置事件让我们屏幕只有移动了摄像机才会重新渲染</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code>OrbitControls<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;change&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>scene<span class="token punctuation">,</span> camera<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>不要禁止抗锯齿然后使用预处理的 AA 处理，这性能会消耗更大</li> <li>灯光是消耗性能的，尽可能少用</li> <li>使用 <code>renderer.physicallyCorrectLights</code> 修正灯光位置</li> <li>如果你想删除或者添加灯光 不要直接删除物体，可以通过 <code>light.visible = false</code> <code>light.intensiy = 0</code> 达到类似的效果 增强性能</li> <li>点光源渲染的阴影消耗最大 我们可以通过 <code>CameraHelper</code> 来展示他</li> <li>如果你使用 <code>morph targets</code> 记得要设置 <code>morghTargets = true</code> 否则这将不会生效</li> <li>材质尺寸要求是双数的，而且应该尽可能的小</li> <li>PNG 或者 JPG 样式的材质到内存中消耗的一致</li> <li>尽量不销毁物体，使用 <code>object.visible = false</code> <code>material.opacity = 0</code> 来代替他</li> <li>透明物体消耗性能，尽可能不使用</li> <li>设置 <code>object.matrixAutoUpdate = false</code> 且当他们位置角度等变化时才调用 <code>object.updateMatrix()</code> 更新</li> <li>使用 <code>geometry instance</code> 当你有许多类似物体要创建时</li> <li>通过烘焙阴影去避免使用灯光</li> <li><code>LOD (Level Of Detail) object</code> 适用于我们物体有远近层次关系 这样他们可能会几帧才更新一次</li></ul> <p><a href="https://discoverthreejs.com/tips-and-tricks/" target="_blank" rel="noopener noreferrer">The Big List of three.js Tips and Tricks! | Discover three.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.8a54f0e1.js" defer></script><script src="/blog/assets/js/2.99672014.js" defer></script><script src="/blog/assets/js/25.8bd8c2c3.js" defer></script>
  </body>
</html>
